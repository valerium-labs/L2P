*****************************************************************************************************************
* L2P ("ЛЕНЬ-В-ПЕНЬ") - подборка модов для приведения таймингов классического Ленинграда-1 к стандарту Пентагона
* на ОДНОЙ микросхеме (пример на EPM3032ALC44)
*
* https://zx-pk.ru/threads/32987-len2pent-kak-dorabotat-tajmingi.html
* valerium@rambler.ru
* Chelyabinsk, Russia, 2021
*
* Thanx to П321, Serg6845, solegstar, IanPo
*****************************************************************************************************************
Требования:

- Ленинград-1;
- Кварц 14,0 МГц;
- Память 4164 или 41256, способная корректно работать без тактов /WAIT процессора.
- Cигнал /IOWR на DD39 в первозданном виде (не инвертирован).
- Сигнал /КС на выв.6 DD40 в первозданном виде.


*****************************************************************************************************************
Доработки:

1. Изменение количества строк в кадре
1.1. Счетчик DD4 включается входами 10 - на +5в, 1,9,15 - на GND (на многих платах это по умолчанию так).
1.2. Счетчик DD5: вход 5 отрезается от схемы и подключается к GND.


2. Отключение /WAIT
Отключается выход 5 DD9 от входа 24 (/WAIT) процессора DD20. Вход 16 DD20 подтянуть резистором 10К к +5в.

*** После этих двух доработок имеем 71680 тактов на 1 кадр (=на 1 период /INT).


3. Подготовка и прошивка CPLD
В проекте она подготовлена для EPM3032ALC44 в корпусе PLCC, ее панелька удобно размещается на макетном поле Ленинграда.
Эту CPLD нужно запитать от 3,3в через линейный стабилизатор AMS1117-3,3 или подобный.
Питание: выводы 3,15,23,35 - +3,3в, выводы 10,17,22,30,36,42 - GND. 
Не забудьте про блокировочные конденсаторы на все 4 входа питания.
Разъем JTAG (можно подключить временно для прошивки): выв.7 - TDI, выв.13 - TMS, выв.32 - TCK, выв.38 - TDO.


4. Корректировка /INT (см. схему в L2P.PNG)
4.1. На вывод 41 CPLD подается сигнал H0 (удобнее взять с выв.1 DD13).
4.2. На вывод 4 CPLD подается сигнал /КС (кадровый синхроимпульс - удобнее взять с выв.6 DD40).
4.3. Убираем C2, R2 и VD20, вход 13 DD1 освобождается от остальной схемы, на него подается сигнал INT с вывода 6 CLPD.

*** После этого бордюрные эффекты уже должны работать правильно и без сдивгов, но диагональные линии будут угловатыми
*** из-за изменения цвета бордюра с точностью до знакоместа (8 пикселей).


5. Корректировка дискретности вывода бордюра с точностью до пикселя (см. схему в L2P.PNG)
5.1. На вывод 40 CPLD подается сигнал H1 (удобнее взять с выв.1 DD40).
5.2. На вывод 39 CPLD подается сигнал H2 (удобнее взять с выв.6 DD10).
5.3. На вывод 43 CPLD подается сигнал ТИ (с выв. 5 DD2).
5.4. Выводы 10 DD31-32 (исходно /BORDER) отрезать от схемы (место разреза показано оранжевым в файле CUTS.PNG с пометкой 5.4).
5.5. На вывод 9 CPLD подается сигнал /BORDER c выв.6 DD13.
5.6. На выводы 10 DD31-32 подается сигнал BORDER_PENT c выв.11 CPLD.
5.7. Выводы 11 DD31-32 (исходно H2) отрезать от схемы (два места разреза показаны оранжевым в файле CUTS.PNG с пометкой 5.7).
5.8. На отрезанную дорожку к выв.1 DD19 восстановить подключение H2 с выв.10 DD14 (соединение показано оранжевым с пометкой 5.8).
5.9. На выводы 11 DD31-32 подать сигнал NEW_H2 с выв.8 CPLD.

